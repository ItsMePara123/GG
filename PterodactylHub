#!/bin/bash
# ====================================================
#        ğŸ§© PTERODACTYL CONTROL CENTER
#        Built & Maintained by Para
#        github.com/ParaOnTop123
# ====================================================

# ================= COLORS =================
GREEN="\033[1;32m"
RED="\033[1;31m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
MAGENTA="\033[1;35m"
NC="\033[0m"

# ================= TYPEWRITER EFFECT =================
typewriter() {
    local text="$1"
    local delay="${2:-0.02}"
    for ((i=0; i<${#text}; i++)); do
        echo -ne "${text:$i:1}"
        sleep "$delay"
    done
    echo
}

pause() {
    read -p "Press Enter to continue..."
}

# ================= INSTALL PANEL =================
install_ptero() {
    clear
    echo -e "${CYAN}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ› ï¸  PTERODACTYL PANEL INSTALLER        â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    typewriter "ğŸš€ Installing Pterodactyl Panel..." 0.03
    bash <(curl -sSL https://raw.githubusercontent.com/ItsMePara123/GG/refs/heads/main/pteroinstall)

    echo -e "${GREEN}âœ… Panel installation completed successfully${NC}"
    pause
}

# ================= CREATE PANEL USER =================
create_user() {
    clear
    echo -e "${CYAN}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ‘¤ PANEL USER MANAGEMENT               â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    if [ ! -d /var/www/pterodactyl ]; then
        echo -e "${RED}âŒ Panel not installed${NC}"
        pause
        return
    fi

    cd /var/www/pterodactyl || return
    php artisan p:user:make

    echo -e "${GREEN}âœ… User created successfully${NC}"
    pause
}

# ================= PANEL + WINGS UNINSTALL CORE =================
uninstall_panel() {
    typewriter "ğŸ›‘ Stopping Panel services..." 0.02
    systemctl stop pteroq.service 2>/dev/null || true
    systemctl disable pteroq.service 2>/dev/null || true
    rm -f /etc/systemd/system/pteroq.service
    systemctl daemon-reload

    typewriter "ğŸ§¹ Removing Panel files..." 0.02
    rm -rf /var/www/pterodactyl

    typewriter "ğŸ—„ï¸ Dropping database & user..." 0.02
    mysql -u root -e "DROP DATABASE IF EXISTS panel;" 2>/dev/null || true
    mysql -u root -e "DROP USER IF EXISTS 'pterodactyl'@'127.0.0.1';" 2>/dev/null || true
    mysql -u root -e "FLUSH PRIVILEGES;" 2>/dev/null || true

    typewriter "ğŸŒ Cleaning Nginx config..." 0.02
    rm -f /etc/nginx/sites-enabled/pterodactyl.conf
    rm -f /etc/nginx/sites-available/pterodactyl.conf
    systemctl reload nginx 2>/dev/null || true

    typewriter "ğŸ›‘ Stopping Wings service..." 0.02
    systemctl stop wings.service 2>/dev/null || true
    systemctl disable wings.service 2>/dev/null || true
    rm -f /etc/systemd/system/wings.service
    systemctl daemon-reload

    typewriter "ğŸ—‘ï¸ Removing Wings files..." 0.02
    rm -rf /etc/pterodactyl
    rm -rf /var/lib/pterodactyl
    rm -rf /var/log/pterodactyl

    echo -e "${GREEN}ğŸ‰ Panel + Wings fully removed${NC}"
}

# ================= UNINSTALL MENU =================
uninstall_ptero() {
    clear
    echo -e "${RED}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ—‘ï¸  UNINSTALL PTERODACTYL              â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    typewriter "âš ï¸ WARNING: This will REMOVE Panel + Wings!" 0.03
    echo
    read -p "Type YES to confirm: " confirm

    if [[ "$confirm" != "YES" ]]; then
        echo -e "${YELLOW}âŒ Uninstall cancelled${NC}"
        sleep 1
        return
    fi

    uninstall_panel
    pause
}

# ================= UPDATE PANEL =================
update_panel() {
    clear
    echo -e "${YELLOW}"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "        ğŸ”„ PTERODACTYL PANEL UPDATE             "
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

    cd /var/www/pterodactyl || {
        echo -e "${RED}âŒ Panel not found${NC}"
        pause
        return
    }

    php artisan down
    curl -L https://github.com/pterodactyl/panel/releases/download/latest/panel.tar.gz | tar -xz
    chmod -R 755 storage/* bootstrap/cache
    composer install --no-dev --optimize-autoloader
    php artisan view:clear
    php artisan config:clear
    php artisan migrate --seed --force
    chown -R www-data:www-data /var/www/pterodactyl/*
    php artisan queue:restart
    php artisan up

    echo -e "${GREEN}ğŸ‰ Panel updated successfully${NC}"
    pause
}

# ================= WELCOME =================
clear
typewriter "ğŸ§© Welcome to Pterodactyl Control Center" 0.04
typewriter "ğŸš€ Built & Maintained by Para" 0.04
typewriter "ğŸ”¥ github.com/ParaOnTop123" 0.04
sleep 1

# ================= MAIN MENU =================
while true; do
    clear
    echo -e "${MAGENTA}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘        ğŸ§© PTERODACTYL CONTROL CENTER           â•‘"
    echo "â•‘              Crafted by Para                  â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo -e "â•‘ ${GREEN}1) ğŸ› ï¸  Install Panel${NC}"
    echo -e "â•‘ ${CYAN}2) ğŸ‘¤ Create Panel User${NC}"
    echo -e "â•‘ ${YELLOW}3) ğŸ”„ Update Panel${NC}"
    echo -e "â•‘ ${RED}4) ğŸ—‘ï¸  Uninstall Panel + Wings${NC}"
    echo -e "â•‘ ğŸšª 0) Exit"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -ne "${CYAN}Select Option â†’ ${NC}"
    read choice

    case $choice in
        1) install_ptero ;;
        2) create_user ;;
        3) update_panel ;;
        4) uninstall_ptero ;;
        0)
            clear
            echo -e "${GREEN}ğŸ‘‹ Thanks for using Para's Control Center${NC}"
            exit
            ;;
        *)
            echo -e "${RED}âŒ Invalid option${NC}"
            sleep 1
            ;;
    esac
done
