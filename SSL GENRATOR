#!/bin/bash

# -------------------------
# Colors
# -------------------------
RED="\033[1;31m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
RESET="\033[0m"

# -------------------------
# Typewriter Effect
# -------------------------
typewriter() {
    local text="$1"
    for ((i=0; i<${#text}; i++)); do
        echo -n "${text:$i:1}"
        sleep 0.02
    done
    echo ""
}

# -------------------------
# PARA Logo
# -------------------------
animate_logo() {
    clear
    local logo=(
"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó "
"‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"
"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë"
"‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë"
"‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë"
"‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù"
    )
    echo ""
    for line in "${logo[@]}"; do
        echo -e "${CYAN}${line}${RESET}"
        sleep 0.05
    done
    echo ""
    typewriter "‚ö° Welcome to the PARA SSL Generator ‚ö°"
    echo ""
}

# -------------------------
# Start Script
# -------------------------
animate_logo

# Ask for domain
typewriter "üåê Enter your domain below:"
read -p "$(echo -e "${YELLOW}üëâ Domain: ${RESET}")" domain

# SSL option
echo ""
typewriter "üîí Choose your SSL type:"
echo -e "${GREEN}1) Certbot (DNS Manual)${RESET}"
echo -e "${GREEN}2) Local Self-Signed SSL${RESET}"
read -p "$(echo -e "${YELLOW}üëâ Enter option (1 or 2): ${RESET}")" option

# -------------------------
# SSL Generation
# -------------------------
case $option in
    1)
        if ! command -v certbot &> /dev/null; then
            typewriter "üß© Certbot not found. Installing..."
            if command -v apt &> /dev/null; then
                sudo apt update
                sudo apt install -y certbot
            elif command -v yum &> /dev/null; then
                sudo yum install -y epel-release
                sudo yum install -y certbot
            elif command -v dnf &> /dev/null; then
                sudo dnf install -y certbot
            else
                echo -e "${RED}üö´ No supported package manager found. Please install Certbot manually.${RESET}"
                exit 1
            fi
        fi

        typewriter "‚öôÔ∏è Starting DNS-based Certbot setup for: $domain"
        sudo certbot -d "$domain" --manual --preferred-challenges dns certonly

        echo ""
        echo -e "${GREEN}‚ú® SSL Certificate Generated Successfully!${RESET}"
        echo -e "${CYAN}üìÅ Location for Nginx config:${RESET}"
        echo -e "ssl_certificate /etc/letsencrypt/live/$domain/fullchain.pem;"
        echo -e "ssl_certificate_key /etc/letsencrypt/live/$domain/privkey.pem;"
        ;;
    2)
        typewriter "üõ† Generating local self-signed SSL for: $domain"
        sudo mkdir -p /etc/certs
        sudo openssl req -new -newkey rsa:4096 -days 3650 -nodes -x509 \
            -subj "/C=NA/ST=NA/L=NA/O=PARA/CN=$domain" \
            -keyout /etc/certs/privkey.pem -out /etc/certs/fullchain.pem
        echo ""
        echo -e "${GREEN}‚úÖ Local SSL generated at:${RESET}"
        echo -e "${CYAN}/etc/certs/fullchain.pem${RESET}"
        echo -e "${CYAN}/etc/certs/privkey.pem${RESET}"
        ;;
    *)
        echo -e "${RED}üö´ Invalid option. Exiting.${RESET}"
        exit 1
        ;;
esac

echo ""
typewriter "üéâ Done! Your SSL setup is complete."
