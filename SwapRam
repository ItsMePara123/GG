#!/bin/bash
# ==========================================
# üß± Auto Swapfile Setup Script
# ‚ú® Made by Para777 ‚ú®
# ==========================================

set -euo pipefail

# ---------- Colors ----------
CYAN="\033[1;36m"
YELLOW="\033[1;33m"
GREEN="\033[1;32m"
RESET="\033[0m"

# ---------- Typewriter Effect ----------
typewriter() {
    local text="$1"
    local delay="${2:-0.02}"
    for ((i=0; i<${#text}; i++)); do
        echo -n "${text:$i:1}"
        sleep "$delay"
    done
    echo ""
}

# ---------- Clear and Banner ----------
clear
echo -e "${CYAN}"
echo "  _____                "
echo " |  __ \               "
echo " | |__) |_ _ _ __ __ _ "
echo " |  ___/ _\` | '__/ _\` |"
echo " | |  | (_| | | | (_| |"
echo " |_|   \__,_|_|  \__,_|"
echo "                       "
echo -e "${RESET}"
typewriter "‚ú® Welcome to Para777 Auto Swap RAM Creator ‚ú®" 0.03
echo ""

# ---------- Ask for swap size ----------
echo -ne "${YELLOW}üíæ Enter the amount of swap space you want (e.g., 4G, 8G, 16G): ${RESET}"
read -r SWAP_SIZE

if [[ -z "$SWAP_SIZE" ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è  No size entered! Defaulting to 8G.${RESET}"
    SWAP_SIZE="8G"
fi

typewriter "üß± Creating swap file of size $SWAP_SIZE ..." 0.03

# ---------- Steps ----------
typewriter "üîÑ Updating system packages..." 0.02
sudo apt update -y >/dev/null 2>&1

typewriter "üì¶ Creating swap file..." 0.02
sudo fallocate -l "$SWAP_SIZE" /swapfile

typewriter "üîí Setting correct permissions..." 0.02
sudo chmod 600 /swapfile

typewriter "‚öôÔ∏è Formatting swap space..." 0.02
sudo mkswap /swapfile >/dev/null 2>&1

typewriter "üöÄ Enabling swap..." 0.02
sudo swapon /swapfile

typewriter "üíæ Making swap permanent..." 0.02
if ! grep -q '/swapfile none swap sw 0 0' /etc/fstab; then
    echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab >/dev/null
fi

# ---------- Summary ----------
echo ""
typewriter "‚úÖ Swap setup complete!" 0.02
sudo swapon --show
free -h

echo ""
typewriter "üéâ‚ú® Swapfile of $SWAP_SIZE created and activated successfully!" 0.03
typewriter "üîß Made by Para777 with ‚ù§Ô∏è" 0.03
echo ""
