#!/bin/bash

# ===========================================
# Para ASCII Art Header
# ===========================================
echo -e "\n\033[1;36m"
cat << "EOF"

 _____        _____            
 |  __ \ /\   |  __ \     /\    
 | |__) /  \  | |__) |   /  \   
 |  ___/ /\ \ |  _  /   / /\ \  
 | |  / ____ \| | \ \  / ____ \ 
 |_| /_/    \_\_|  \_\/_/    \_\
                                   
                                   
 💙 Cockpit + Virtualization Installer
    github.com/ItsMePara123

EOF
echo -e "\033[0m"

# ===========================================
# Commands to Execute
# ===========================================
commands=(
  "apt update -y && apt upgrade -y"
  "apt install -y cockpit"
  "systemctl enable --now cockpit.socket"
  "apt install -y qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager"
  "systemctl enable --now libvirtd"
  "apt install -y cockpit-machines"
  "usermod -aG libvirt,kvm $SUDO_USER"
)

steps=(
  "Updating system packages"
  "Installing Cockpit"
  "Enabling Cockpit service"
  "Installing virtualization packages (KVM, Libvirt, etc.)"
  "Enabling Libvirt service"
  "Installing Cockpit Machines extension"
  "Adding current user to libvirt & kvm groups"
)

# ===========================================
# Execution Loop
# ===========================================
for i in "${!commands[@]}"; do
  echo -e "\033[1;34m[Step $((i+1))/${#commands[@]}] ${steps[$i]}...\033[0m"
  echo -e "\033[0;35m${commands[$i]}\033[0m"
  eval "${commands[$i]}"
  if [ $? -ne 0 ]; then
    echo -e "\033[1;31m❌ Error at step $((i+1)): ${steps[$i]}.\033[0m"
    exit 1
  else
    echo -e "\033[1;32m✔ Completed: ${steps[$i]}\033[0m\n"
  fi
done

# ===========================================
# Completion Message
# ===========================================
IP=$(hostname -I | awk '{print $1}')

echo -e "\n\033[1;32m===========================================\033[0m"
echo -e "\033[1;32m Cockpit + Virtualization installed! 🎉\033[0m"
echo -e "\033[1;35m  Access Cockpit at: http://$IP:9090\033[0m"
echo -e "\033[1;33m  (Keep localhost:9090 and HTTP)\033[0m"
echo -e "\033[1;33m  (Use your server username & password)\033[0m"
echo -e "\033[1;31m  NOTE: Re-login required for group changes\033[0m"
echo -e "\033[1;32m===========================================\033[0m"
