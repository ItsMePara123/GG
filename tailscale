#!/bin/bash
# ========================================================
# ğŸŒ€ Tailscale Installer & Manager
# Made with â¤ï¸ by Para
# ========================================================

# --- Colors ---
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[35m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# --- Header ---
display_header() {
    clear
    echo -e "${MAGENTA}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${MAGENTA}â•‘${NC}${BOLD}       ğŸŒ  PARA'S TAILSCALE MANAGER  ğŸŒ       ${NC}${MAGENTA}â•‘${NC}"
    echo -e "${MAGENTA}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# --- Check Tailscale Status ---
check_status() {
    if command -v tailscale &> /dev/null; then
        if systemctl is-active --quiet tailscaled; then
            echo -e "Status: ${GREEN}${BOLD}âœ… INSTALLED & RUNNING${NC}"
        else
            echo -e "Status: ${YELLOW}${BOLD}âš  INSTALLED (NOT RUNNING)${NC}"
        fi
    else
        echo -e "Status: ${RED}${BOLD}âŒ NOT INSTALLED${NC}"
    fi
}

# --- Install Tailscale ---
install_tailscale() {
    echo -e "\n${CYAN}${BOLD}ğŸš€ Installing Tailscale...${NC}\n"
    
    echo -e "${YELLOW}1ï¸âƒ£  Downloading installer...${NC}"
    if curl -fsSL https://tailscale.com/install.sh | sh; then
        echo -e "${GREEN}âœ“ Download complete${NC}"
    else
        echo -e "${RED}âœ— Download failed${NC}"
        return 1
    fi

    echo -e "\n${YELLOW}2ï¸âƒ£  Starting service...${NC}"
    sudo systemctl enable --now tailscaled
    echo -e "${GREEN}âœ“ Service started${NC}"

    echo -e "\n${YELLOW}3ï¸âƒ£  Connect to your network...${NC}"
    echo -e "${CYAN}Please authenticate in your browser when prompted ğŸŒ${NC}"
    sudo tailscale up

    echo -e "\n${GREEN}${BOLD}ğŸ‰ TAILSCALE INSTALLATION COMPLETE!${NC}\n"
    echo -e "Access your Tailscale network: ${CYAN}tailscale status${NC}"
}

# --- Uninstall Tailscale ---
uninstall_tailscale() {
    echo -e "\n${RED}${BOLD}ğŸ—‘ï¸  Uninstalling Tailscale...${NC}\n"
    echo -e "${RED}âš  WARNING: This will remove Tailscale completely!${NC}\n"
    
    read -p "Are you sure? (yes/no): " confirm
    if [[ ! $confirm =~ ^[Yy][Ee]?[Ss]?$ ]]; then
        echo -e "${GREEN}Cancelled. Tailscale was NOT removed.${NC}"
        return
    fi

    echo -e "${YELLOW}1ï¸âƒ£  Stopping service...${NC}"
    sudo systemctl stop tailscaled
    sudo systemctl disable tailscaled
    echo -e "${GREEN}âœ“ Service stopped${NC}"

    echo -e "${YELLOW}2ï¸âƒ£  Removing package...${NC}"
    sudo apt purge tailscale -y
    echo -e "${GREEN}âœ“ Package removed${NC}"

    echo -e "${YELLOW}3ï¸âƒ£  Cleaning up files...${NC}"
    sudo rm -rf /var/lib/tailscale /etc/tailscale /var/cache/tailscale
    echo -e "${GREEN}âœ“ Files cleaned${NC}"

    echo -e "${YELLOW}4ï¸âƒ£  Removing dependencies...${NC}"
    sudo apt autoremove -y
    echo -e "${GREEN}âœ“ Dependencies removed${NC}"

    echo -e "\n${RED}${BOLD}ğŸ—‘ï¸ TAILSCALE COMPLETELY REMOVED!${NC}"
}

# --- Main Menu ---
while true; do
    display_header
    check_status
    echo ""
    echo -e "${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "  ${GREEN}[1]${NC} ğŸ“¥ Install Tailscale"
    echo -e "  ${RED}[2]${NC} ğŸ—‘ï¸  Uninstall Tailscale"
    echo -e "  ${YELLOW}[3]${NC} ğŸšª Exit"
    echo -e "${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
    
    read -rp "Select an option [1-3]: " option
    case $option in
        1) install_tailscale ;;
        2) uninstall_tailscale ;;
        3)
            echo -e "\n${CYAN}ğŸ‘‹ Goodbye from Para!${NC}\n"
            exit 0 ;;
        *) echo -e "\n${RED}âŒ Invalid option! Choose 1, 2, or 3.${NC}" ;;
    esac
    echo ""
    read -p "Press Enter to continue..."
done
