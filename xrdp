#!/bin/bash

set -e

###################################################
# üöÄ XRDP Desktop Installer ‚Äî Powered By Para
###################################################
clear
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "üñ•Ô∏è  XRDP Desktop Environment Auto Installer"
echo "üî• By Para"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
sleep 1

# üåç Auto-detect Server IP
IP=$(hostname -I | awk '{print $1}')

echo "üîÑ Updating system packages..."
apt update -y && apt upgrade -y

echo "üì¶ Installing XRDP + XFCE Desktop..."
apt install -y xrdp xfce4 xfce4-goodies dbus-x11

echo "‚öôÔ∏è Enabling XRDP service..."
systemctl enable xrdp
systemctl restart xrdp

echo "üîê Setting root password ‚Üí root"
echo -e "root\nroot" | passwd root

echo "üõÇ Allowing ROOT login in XRDP..."
sed -i 's/^AllowRootLogin=false/AllowRootLogin=true/' /etc/xrdp/sesman.ini || true

echo "üîß Adjusting PAM to allow root login..."
sed -i 's/^auth required pam_succeed_if.so user != root quiet_success/#&/' /etc/pam.d/xrdp-sesman || true

echo "üé® Setting XFCE as default session for root..."
echo "startxfce4" > /root/.xsession
chmod +x /root/.xsession

echo "üîë Fixing permissions..."
adduser xrdp ssl-cert || true

echo "‚ôªÔ∏è Restarting XRDP..."
systemctl restart xrdp

###################################################
# ‚å® TYPEWRITER FINISH MESSAGE ‚Äî BY PARA
###################################################
type_print() {
    text="$1"
    for (( i=0; i<${#text}; i++ )); do
        echo -n "${text:$i:1}"
        sleep 0.03
    done
    echo ""
}

echo ""
type_print "üéâ XRDP Desktop Installed Successfully!"
type_print "üîó Server IP  : $IP"
type_print "üë§ Username   : root"
type_print "üîë Password   : root"
type_print "üñ• Session    : Xorg"
type_print "‚ú® Powered By Para"
