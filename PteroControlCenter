#!/bin/bash
# ====================================================
#        PTERODACTYL CONTROL CENTER
#        Built & Maintained by Para
#        github.com/ParaOnTop123
# ====================================================

GREEN="\033[1;32m"
RED="\033[1;31m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
MAGENTA="\033[1;35m"
NC="\033[0m"

# ================== INSTALL PANEL ==================
install_ptero() {
    clear
    echo -e "${CYAN}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ› ï¸  Pterodactyl Panel Installer        â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    bash <(curl -sSL https://raw.githubusercontent.com/ItsMePara123/GG/refs/heads/main/pteroinstall)

    echo -e "${GREEN}âœ” Panel installation completed successfully${NC}"
    read -p "Press Enter to return..."
}

# ================== CREATE PANEL USER ==================
create_user() {
    clear
    echo -e "${CYAN}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ‘¤ Panel User Management               â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    if [ ! -d /var/www/pterodactyl ]; then
        echo -e "${RED}âŒ Panel is not installed on this system${NC}"
        read -p "Press Enter to return..."
        return
    fi

    cd /var/www/pterodactyl || exit
    php artisan p:user:make

    echo -e "${GREEN}âœ” User created successfully${NC}"
    read -p "Press Enter to return..."
}

# ================== UNINSTALL PANEL ==================
# ================= PANEL + WINGS UNINSTALL CORE =================
uninstall_panel() {
    echo -e "ğŸ›‘ \e[1;31mStopping Panel service...\e[0m"
    systemctl stop pteroq.service 2>/dev/null || true
    systemctl disable pteroq.service 2>/dev/null || true
    rm -f /etc/systemd/system/pteroq.service
    systemctl daemon-reload

    echo -e "ğŸ—‘ï¸  \e[1;33mRemoving Panel cronjob...\e[0m"
    crontab -l | grep -v 'php /var/www/pterodactyl/artisan schedule:run' | crontab - 2>/dev/null || true

    echo -e "ğŸ§¹ \e[1;33mRemoving Panel files...\e[0m"
    rm -rf /var/www/pterodactyl

    echo -e "ğŸ—„ï¸  \e[1;33mDropping Panel database & user...\e[0m"
    mysql -u root -e "DROP DATABASE IF EXISTS panel;" 2>/dev/null || true
    mysql -u root -e "DROP USER IF EXISTS 'pterodactyl'@'127.0.0.1';" 2>/dev/null || true
    mysql -u root -e "FLUSH PRIVILEGES;" 2>/dev/null || true

    echo -e "ğŸŒ \e[1;33mCleaning Nginx config...\e[0m"
    rm -f /etc/nginx/sites-enabled/pterodactyl.conf
    rm -f /etc/nginx/sites-available/pterodactyl.conf
    systemctl reload nginx 2>/dev/null || true

    echo -e "\nğŸ›‘ \e[1;31mStopping Wings service...\e[0m"
    systemctl stop wings.service 2>/dev/null || true
    systemctl disable wings.service 2>/dev/null || true
    rm -f /etc/systemd/system/wings.service
    systemctl daemon-reload

    echo -e "ğŸ—‘ï¸  \e[1;33mRemoving Wings files...\e[0m"
    rm -rf /etc/pterodactyl
    rm -rf /var/lib/pterodactyl
    rm -rf /var/log/pterodactyl

    echo -e "\nâœ… \e[1;32mPanel + Wings fully uninstalled successfully!\e[0m"
}

uninstall_ptero() {
    clear
    echo -e "${RED}"
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
    echo "â”‚        ğŸ—‘ï¸  Remove Pterodactyl Panel          â”‚"
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

    uninstall_panel_core

    echo -e "${GREEN}âœ” Panel removed successfully (Wings untouched)${NC}"
    read -p "Press Enter to return..."
}

# ================== UPDATE PANEL ==================
update_panel() {
    clear
    echo -e "${YELLOW}"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "        ğŸ”„ PTERODACTYL PANEL UPDATE             "
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

    cd /var/www/pterodactyl || {
        echo -e "${RED}âŒ Panel directory not found${NC}"
        read
        return
    }

    php artisan down
    curl -L https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz | tar -xzv
    chmod -R 755 storage/* bootstrap/cache
    composer install --no-dev --optimize-autoloader
    php artisan view:clear
    php artisan config:clear
    php artisan migrate --seed --force
    chown -R www-data:www-data /var/www/pterodactyl/*
    php artisan queue:restart
    php artisan up

    echo -e "${GREEN}ğŸ‰ Panel updated successfully${NC}"
    read -p "Press Enter to return..."
}

# ===================== MAIN MENU =====================
while true; do
clear
echo -e "${MAGENTA}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘        ğŸ§© PTERODACTYL CONTROL CENTER           â•‘"
echo "â•‘              Crafted by Para                  â•‘"
echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo -e "â•‘ ${GREEN}1) Install Panel${NC}"
echo -e "â•‘ ${CYAN}2) Create Panel User${NC}"
echo -e "â•‘ ${YELLOW}3) Update Panel${NC}"
echo -e "â•‘ ${RED}4) Uninstall Panel${NC}"
echo -e "â•‘ ğŸšª 0) Exit"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -ne "${CYAN}Select Option â†’ ${NC}"
read choice

case $choice in
    1) install_ptero ;;
    2) create_user ;;
    3) update_panel ;;
    4) uninstall_ptero ;;
    0)
        clear
        echo -e "${GREEN}Thanks for using Para's Control Center ğŸ‘‹${NC}"
        exit
        ;;
    *)
        echo -e "${RED}Invalid option. Try again.${NC}"
        sleep 1
        ;;
esac
done
