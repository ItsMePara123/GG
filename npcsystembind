#!/bin/bash

clear
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo " ğŸš€ NPC Systemd Binder - Para"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Ask NPC directory
read -p "ğŸ‘‰ Enter NPC directory [default: nps-setup]: " NPC_DIR
NPC_DIR=${NPC_DIR:-nps-setup}

# Full path (assume under /root)
NPC_PATH="/root/${NPC_DIR}"

# Ask server details
read -p "ğŸ‘‰ Enter NPS Server IP: " SERVER_IP
read -p "ğŸ‘‰ Enter Connection Port: " CONN_PORT
read -p "ğŸ‘‰ Enter VKEY: " VKEY

# Basic checks
if [ ! -f "${NPC_PATH}/npc" ]; then
  echo ""
  echo "âŒ npc binary not found in ${NPC_PATH}"
  echo "ğŸ‘‰ Make sure npc exists and is executable"
  exit 1
fi

chmod +x ${NPC_PATH}/npc

echo ""
echo "ğŸ›  Creating systemd service..."

cat > /etc/systemd/system/npc.service <<EOF
[Unit]
Description=NPC Client
After=network.target

[Service]
Type=simple
WorkingDirectory=${NPC_PATH}
ExecStart=${NPC_PATH}/npc -server ${SERVER_IP}:${CONN_PORT} -vkey ${VKEY}
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOF

echo "ğŸ”„ Reloading systemd..."
systemctl daemon-reload

echo "âœ… Enabling NPC service..."
systemctl enable npc >/dev/null 2>&1

echo "â–¶ï¸ Starting NPC service..."
systemctl start npc

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo " âœ… NPC Service Installed!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo " ğŸ“‚ Directory : ${NPC_PATH}"
echo " ğŸŒ Server    : ${SERVER_IP}:${CONN_PORT}"
echo " ğŸ”‘ VKEY      : ${VKEY}"
echo " ğŸ›  Manage    : systemctl status npc"
echo " ğŸ” Restart   : systemctl restart npc"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
